<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        /* Updated Container Styling */
        body,
        html {
          height: 100%;
          margin: 0;
          font-family: 'Nunito', sans-serif;
          background-color: #f0f2f5;
        }
  
        .container {

padding: 20px;
}
  
        /* Parking Spot Styling */
        .parking-spot-wrapper {
          display: flex;
          flex-direction: column;
          align-items: center;
        }
  
        .parking-spot {
          width: 160px;
          height: 240px;
          margin: 20px;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          font-weight: 600;
          border: 2px solid #ccc;
          font-size: 18px;
          text-align: center;
          padding: 10px;
          box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
          cursor: pointer;
          border-radius: 8px;
        }
  
        .free {
          background-color: #d1e7dd;
          color: #0f5132;
        }
  
        .booked {
          background-color: #ffe8a1;
          color: #856404;
        }
  
        .in-use {
          background-color: #f8d7da;
          color: #842029;
        }
  
        .parking-spot-container {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 20px;
          justify-items: center;
          flex-grow: 1;
          height: calc(100vh - 200px);
        }
  
        .form-switch {
          margin-top: 10px;
        }
  
        .toggle-wrapper {
          margin-top: 5px;
        }
  
        /* Navbar Styling */
        .navbar {
          background: #0062cc;
        }
  
        .navbar-brand {
          font-family: 'Poppins', sans-serif;
          font-weight: 700;
          font-size: 1.5rem;
          color: #fff;
        }
  
        .nav-link {
          font-size: 1rem;
          color: #fff;
        }
  
        /* Button Styling */
        .btn-primary {
          background-color: #0d6efd;
          border-color: #0d6efd;
        }
  
        .btn-danger {
          background-color: #dc3545;
          border-color: #dc3545;
        }
      </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Parking Booking</a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="{% url 'home' %}">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="{% url 'payment' %}">Payment</a>
                </li>
              </ul>
          </ul>

          <a class="nav-link active" aria-current="page" style="margin-right: 2%;">{{ balance }}</a>
          
          <a class="nav-link active" aria-current="page" style="margin-right: 1%;">{{ user.get_full_name }} ({{ user.username }})</a>
          <form action="{% url 'logout' %}" method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger btn-sm">Logout</button>
          </form>
        </div>
      </div>
    </nav>

    <div class="container d-flex justify-content-center">
        <div class="card p-4" style="width: 100%; max-width: 500px;">
          <div class="balance-container">
            <h5 class="card-title">Current Balance: <span id="balance">{{ balance }}</span> USD</h5>
          </div>
      
          <div id="message" class="alert d-none" role="alert"></div>
      
          <div class="row">
            <div class="col-md-12">
              <h3>Deposit Money</h3>
              <form id="deposit-form">
                <div class="mb-3">
                  <label for="deposit-amount" class="form-label">Amount</label>
                  <input type="number" class="form-control" id="deposit-amount" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">Deposit</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      

    <script>
      document.addEventListener("DOMContentLoaded", function () {


        // Handle deposit form submission
        document.getElementById("deposit-form").addEventListener("submit", function (e) {
          e.preventDefault();
          const amount = document.getElementById("deposit-amount").value;

          fetch("/parking/payment/", {
            method: "POST",
            headers: { 
              "Content-Type": "application/x-www-form-urlencoded",
              "X-CSRFToken": "{{ csrf_token }}"
            },
            body: new URLSearchParams({ action: "deposit", amount }),
          })
            .then((response) => response.json())
            .then((data) => {
              // Show message
              const messageElement = document.getElementById("message");
              messageElement.classList.remove('d-none');
              if (data.new_balance) {
                document.getElementById("balance").innerText = data.new_balance;
                messageElement.classList.add('alert-success');
                messageElement.innerText = `Deposit successful! New balance: ${data.new_balance} USD`;
              } else {
                messageElement.classList.add('alert-danger');
                messageElement.innerText = data.message || "An error occurred!";
              }
              // Reset the form
              document.getElementById("deposit-form").reset();
            });
        });

        // Handle pay form submission
        document.getElementById("pay-form").addEventListener("submit", function (e) {
          e.preventDefault();
          const amount = document.getElementById("pay-amount").value;

          fetch("/parking/payment/", {
            method: "POST",
            headers: { 
              "Content-Type": "application/x-www-form-urlencoded",
              "X-CSRFToken": "{{ csrf_token }}"
            },
            body: new URLSearchParams({ action: "pay", amount }),
          })
            .then((response) => response.json())
            .then((data) => {
              // Show message
              const messageElement = document.getElementById("message");
              messageElement.classList.remove('d-none');
              if (data.new_balance) {
                document.getElementById("balance").innerText = data.new_balance;
                messageElement.classList.add('alert-success');
                messageElement.innerText = `Payment successful! New balance: ${data.new_balance} USD`;
              } else {
                messageElement.classList.add('alert-danger');
                messageElement.innerText = data.error || "An error occurred!";
              }
              // Reset the form
              document.getElementById("pay-form").reset();
            });
        });
      });
    </script>
  </body>
</html>
